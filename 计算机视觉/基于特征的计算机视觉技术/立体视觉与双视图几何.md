# 立体视觉与双视图几何

# 一、立体视觉

一个相机拍照时，无法判断拍照物到相机的距离。  
需要用两个相机。

## 1.1 简单情况

**理想情况**：两个平行相机

<details>
<summary>示意图</summary>

![stereo_vision](pngs/stereo_vision.png)

</details>

建立方程组，就可以解出$Z_p$
    $$
    \begin{cases}
    \frac {u_l} f = \frac {X_p} {Z_p} \\
    \\
    \frac {u_r} f = \frac {X_p - b} {Z_p} 
    \end{cases}
    \Rightarrow Z_p = \frac {bf} {u_l - u_r}
    $$

- 所以可以这样来检测距离：
    1. 找到两张照片中所有相互对应的像素点
    2. 每队像素点，都可以计算$u_l - u_r$
        - $u_l - u_r$称为**视差(disparity)**
    3. 估算$Z_p$

## 1.2 一般情况：三角测量（triangulation）

- 需要考虑到这些参数：
    1. 两个相机的“**位姿**”不同，即**外参**不同
    2. 两个相机不可能完全一样，即**内参**不同
    - 可以先用[视觉几何与摄像机标定](计算机视觉/基于特征的计算机视觉技术/视觉几何与摄像机标定.md)提到的**多平面校准**，计算出**内参**、**外参**
- 稍微简化一下：
    1. 首先假设真实世界的坐标系，与第一个相机的坐标系重合。
        - 于是第一个相机的**外参**$[R|T]=[I|0]$。
    2. 第二个相机的**外参**为$[R|T]$

<details>
<summary>理想情况</summary>

![triangulation_simple](pngs/triangulation_simple.png)

> 两个相机**内参**完全一样，$C_1P_1、C_2P_2$两条射线会相交于一点

</details>

但是由于相机**内参**不同，$C_1P_1、C_2P_2$两条射线不会相交。  
此时怎么确定P点呢？

**寻找距离两条射线最近的那个点**

<details>
<summary>几何意义</summary>

![triangulation_geometry](pngs/triangulation_geometry.png)

</details>

###  1.2.1 直接求解

![triangulation_linear](pngs/triangulation_linear.png)

> 如上图所示，$\tilde{p}_1、\tilde{p}_2、M_1、M_2$均已知。  
> 需要计算$\tilde{P}$的坐标。  
> 6个方程，3个未知数，使用**SVD（奇异值分解）**来求解


###  1.2.2 最小化平方误差

通过最小化这个误差，来估算P点的坐标：
$$
SSRE = ||p_1 - M_1 P ||^2 + ||p_2 - M_2 P ||^2
$$


熟悉的套路：
1. 直接求解，先得到初始的P点坐标
2. 最小化平方误差，迭代寻找最优解

### 1.2.3 对baseline比较敏感

如果baseline太小，预测误差就会比较大

<details>
<summary>示意图</summary>

![triangulation_baseline](pngs/triangulation_baseline.png)
> baseline即两个相机间的距离。可以回顾下**1.1 简单情况**中的示意图

</details>

