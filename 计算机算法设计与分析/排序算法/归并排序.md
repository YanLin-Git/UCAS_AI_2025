# 归并排序

# 一、合并两个有序数组

**归并排序**，主要依赖于这步合并操作，先来分析下它的复杂度

#### 1.1 最好情况

- 例如合并两个数组`{1,2,3}`，`{5,6,7,8,9}`
    1. `1`与`5`比较，放置好`1`
    2. `2`与`5`比较，放置好`2`
    3. `3`与`5`比较，放置好`3`，结束
    - 仅需比较3次
- 最好情况下，需要比较$min\{n_1, n_2\}$次

#### 1.2 最差情况

- 例如合并两个数组`{1,2,5,8,10}`、`{3,4,6,7,9}`
    1. `1`与`3`比较，放置好`1`
    2. `2`与`3`比较，放置好`2`
    3. `3`与`5`比较，放置好`3`
    4. ...
    5. `9`与`10`比较，放置好`9`，最后放置`10`
- 每个元素确定自己的位置时，都需要参与一次比较，共需要比较$n_1 + n_2 -1$次

# 二、归并排序

## 2.1 底&分&合

**分**：将整个数组切分为两部分，分别去排序  
**底**：拆封到数组只剩一个元素时，直接返回  
**合**：将两个有序数组合并

## 2.2 复杂度分析

### 2.2.1 最差情况

> 最坏情况下，比较次数为$n_1 + n_2 -1 = n-1$

因此递推关系如下:
$$
\begin{cases}
T(1) = 0 \\
T(n) = T(\lceil \frac n 2 \rceil) + T(\lfloor \frac n 2 \rfloor) + (n-1)
\end{cases}
$$

<details>
<summary>序列求和法</summary>

不妨令$n=2^k \Rightarrow \lceil \frac n 2 \rceil = \lfloor \frac n 2 \rfloor = \frac n 2 = 2^{k-1}$

$$
\begin{aligned}
T(n) &= 2T(2^{k-1}) + 2^k -1 \\
&= 2 \left[ 2T(2^{k-2}) + 2^{k-1} -1 \right] + 2^k -1 \\
&= 2^2 T(2^{k-2}) + (2^k-2) + (2^k-1) \\
&= ... \\
&= 2^k T(2^0) + (2^k-2^{k-1}) + ... + (2^k-2) + (2^k-1) \\
&= k2^k - (2^{k-1} + ... + 2 + 1) \\
&= k2^k - (2^k - 1) \\
&= n \lg n - (n - 1)
\end{aligned}
$$

</details>

经过严格推导，可以看到归并排序的最坏复杂度为 $\Theta(n \lg n)$，且隐含的常数因子为`1`

<details>
<summary>主方法</summary>

可简单认为递推关系为：$T(n) = 2T(\frac n 2) + (n-1)$  
利用**规则2**，得出：$T(n) = \Theta(n \lg n)$

> 不过这里看不出隐含的常数因子

</details>

### 2.2.2 最好情况

> 最坏情况下，比较次数为 $ min\{ n_1, n_2 \} = \lfloor \frac n 2 \rfloor$

因此递推关系如下:
$$
\begin{cases}
T(1) = 0 \\
T(n) = T(\lceil \frac n 2 \rceil) + T(\lfloor \frac n 2 \rfloor) + \lfloor \frac n 2 \rfloor
\end{cases}
$$

同理可以求得：$T(n) = \Theta(n \lg n)$

### 2.2.3 平均情况

因为最好、最差情况都是 $T(n) = \Theta(n \lg n)$

平均情况必定也是